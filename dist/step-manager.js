!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.stepManager=t():e.stepManager=t()}(window,(function(){return function(e){var t={};function s(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(o,i,function(t){return e[t]}.bind(null,i));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s="./src/index.js")}({"./src/cache-manager.js":function(e,t,s){"use strict";s.d(t,"default",(function(){return o}));class o{constructor(e){const t=e||{};this.options=Object.assign({cacheMethod:"sessionStorage",keyBrowserStorage:"stepManager"},t)}getDatasFromCache(e){let t=null;const s=window[this.options.cacheMethod].getItem(this.options.keyBrowserStorage)||null;if(null!==s){const o=JSON.parse(s);t=Array.isArray(e)?this.filterDatas(e,o):o}return t}filterDatas(e,t){let s=null;const o=Object.keys(t).filter(t=>e.includes(t));return o.length&&(s={},o.map(e=>s[e]=t[e])),s}setDatasToCache({id:e,datas:t}){let s=this.getDatasFromCache();s||(s={}),s[e]||(s[e]={}),s[e].datas=t,window[this.options.cacheMethod].setItem(`${this.options.keyBrowserStorage}`,JSON.stringify(s))}removeDatasFromCache(){window[this.options.cacheMethod].removeItem(`${this.options.keyBrowserStorage}`)}}},"./src/index.js":function(e,t,s){"use strict";s.r(t);var o=s("./src/manager.js");s.d(t,"Manager",(function(){return o.default}));var i=s("./src/steps.js");s.d(t,"Steps",(function(){return i.default}))},"./src/manager.js":function(e,t,s){"use strict";s.d(t,"default",(function(){return r}));var o=s("./src/router.js"),i=s("./src/cache-manager.js");
/**
 * @license MIT
 * @name StepManager
 * @version 1.2.1
 * @author: Yoriiis aka Joris DANIEL <joris.daniel@gmail.com>
 * @description: StepManager is a library to create flexible and robust multiple steps navigation with hash, validations, browser storage and hook functions.
 * {@link https://github.com/yoriiis/step-manager}
 * @copyright 2020 Joris DANIEL
 **/
class r{constructor(e){const t=e||{};this.options=Object.assign({element:null,datas:{},steps:[],cacheMethod:"sessionStorage",keyBrowserStorage:"stepManager",ignoredHash:[],onComplete:()=>{},onChange:()=>{}},t),this.isCompleted=!1,this.triggerPreviousStep=this.triggerPreviousStep.bind(this),this.triggerNextStep=this.triggerNextStep.bind(this)}init(){this.addEvents();const e=this.analyzeSteps();this.steps=e.steps,this.CacheManager=new i.default({cacheMethod:this.options.cacheMethod,keyBrowserStorage:this.options.keyBrowserStorage}),this.Router=new o.default({defaultRoute:e.defaultRoute,stepsOrder:e.stepsOrder,steps:this.steps,ignoredHash:this.options.ignoredHash,getDatasFromCache:e=>this.CacheManager.getDatasFromCache(e),onChange:this.options.onChange}),this.Router.init()}analyzeSteps(){const e={},t=[];let s;return this.options.steps.forEach((o,i)=>{const r=new o,n=r.id;r.requestOptions=()=>this.options,r.requestDatas=(...e)=>this.CacheManager.getDatasFromCache(e),e[n]=r,t.push({id:n,route:r.route}),0===i&&(s=r.route)}),{steps:e,stepsOrder:t,defaultRoute:s}}addEvents(){this.eventNextStep=new window.Event("nextStep"),this.options.element.addEventListener("nextStep",this.triggerNextStep,!1),this.eventNextStep=new window.Event("previousStep"),this.options.element.addEventListener("previousStep",this.triggerPreviousStep,!1)}triggerNextStep(e){if(!this.isCompleted){const e=this.Router.getRouteId(this.Router.currentRoute),t=this.steps[e].getDatasFromStep();this.CacheManager.setDatasToCache({id:e,datas:t}),this.Router.triggerNext()||this.allStepsComplete()}}triggerPreviousStep(e){this.Router.triggerPrevious()}allStepsComplete(){this.isCompleted=!0,this.options.element.classList.add("loading"),"function"==typeof this.options.onComplete&&this.options.onComplete(this.CacheManager.getDatasFromCache()),this.CacheManager.removeDatasFromCache()}destroy(){this.options.element.removeEventListener("nextStep",this.triggerNextStep),this.options.element.removeEventListener("previousStep",this.triggerPreviousStep),this.Router.setRoute(""),this.Router.destroy(),this.options.element.remove()}}},"./src/router.js":function(e,t,s){"use strict";s.d(t,"default",(function(){return o}));class o{constructor(e){const t=e||{};this.options=Object.assign({defaultRoute:null,stepsOrder:[],steps:{},ignoredHash:[],getDatasFromCache:()=>{},onChange:()=>{}},t),this.reverseNavigation=!1,this.stepCreated=!1,this.applicationReady=!1,this.stepRedirected={},this.hashChanged=this.hashChanged.bind(this)}init(){this.addEvents();const e=this.getRoute();this.currentRoute=""===e?this.options.defaultRoute:e,""===e?this.setRoute(this.currentRoute):this.hashChanged()}addEvents(){window.addEventListener("hashchange",this.hashChanged,!1)}hashChanged(e){const t=this.getRoute();if(this.isIgnoredHashUsedToLeave(t))return void(this.previousRouteBeforeLeaving=this.getPreviousRoute(e));if(this.isIgnoredHashUsedToComeBack(t))return void(this.previousRouteBeforeLeaving=null);const s=this.checkIfTheStepCanBeDisplay({route:t,event:e});this.currentRoute=t,s.canBeDisplayed?this.stepCanBeDisplayed(e,s.fallbackRoute):this.stepCantBeDisplayed(e,s.fallbackRoute)}async stepCanBeDisplayed(e){e&&(this.previousRouteBeforeLeaving?(this.previousRoute=this.previousRouteBeforeLeaving,this.previousRouteBeforeLeaving=null):this.previousRoute=this.stepRedirected.redirect?this.stepRedirected.previousRoute:this.getPreviousRoute(e),this.previousRoute&&(await this.destroyStep(this.previousRoute),await this.createStep(this.currentRoute),this.stepCreated=!0)),this.stepCreated||await this.createStep(this.currentRoute),this.stepRedirected.redirect&&(this.stepRedirected.redirect=!1)}stepCantBeDisplayed(e,t){this.stepRedirected={redirect:!0,previousRoute:this.getPreviousRoute(e)},this.previousRoute=null,t?this.setRoute(t):this.setRoute(this.options.defaultRoute)}checkIfTheStepCanBeDisplay({route:e,event:t}){const s=this.getRouteId(e);if(this.options.steps[s]){return this.options.steps[s].canTheStepBeDisplayed()}{let e=this.options.defaultRoute;const s=this.getPreviousRoute(t),o=this.getRouteId(s);return s&&this.options.steps[o].fallbackRoute&&(e=this.options.steps[o].fallbackRoute),{canBeDisplayed:!1,fallbackRoute:e}}}async createStep(e){const t=this.getRouteId(e),s=this.options.getDatasFromCache([t]);s?this.options.steps[t].render(s[t].datas):this.options.steps[t].render(),this.applicationReady||(this.applicationReady=!0),"function"==typeof this.options.onChange&&await this.options.onChange("create")}async destroyStep(e){const t=this.getRouteId(e);"function"==typeof this.options.onChange&&await this.options.onChange("destroy"),this.options.steps[t].destroy()}triggerNext(){this.reverseNavigation=!1,this.previousRoute=this.currentRoute;const e=this.getNextStepRoute(this.currentRoute);return"end"!==e&&(this.setRoute(e),!0)}triggerPrevious(){this.reverseNavigation=!0,this.previousRoute=this.currentRoute;const e=this.getPreviousStepRoute(this.previousRoute);this.setRoute(e)}isReverseNavigation(){let e=0,t=0;return this.options.stepsOrder.forEach((s,o)=>{s.route===this.currentRoute&&(e=o),s.route===this.previousRoute&&(t=o)}),e<t}isIgnoredHashUsedToLeave(e){return this.options.ignoredHash.includes(e)}isIgnoredHashUsedToComeBack(e){return null!==this.previousRouteBeforeLeaving&&this.previousRouteBeforeLeaving===e}getRouteId(e){const t=this.options.stepsOrder.find(t=>t.route===e);return t?t.id:null}getPreviousRoute(e){return e&&e.oldURL?e.oldURL.split("#")[1]:null}getPreviousStepRoute(e){const t=parseInt(this.getIndexFromRoute(e)),s=this.options.stepsOrder[t-1];return s?s.route:this.options.defaultRoute}getNextStepRoute(e){const t=parseInt(this.getIndexFromRoute(e)),s=this.options.stepsOrder[t+1];return s?s.route:"end"}getIndexFromRoute(e){return this.options.stepsOrder.findIndex(t=>t.route===e)}getRoute(){return window.location.hash.substr(1)}setRoute(e){window.location.hash=e}destroy(){window.removeEventListener("hashchange",this.hashChanged)}}},"./src/steps.js":function(e,t,s){"use strict";function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,"default",(function(){return i}));class i{constructor(){o(this,"fallbackRoute",null),o(this,"optionalStep",!1),this.clickOnCurrentStep=this.clickOnCurrentStep.bind(this)}render(e){this.options=this.requestOptions(),this.options.element.insertAdjacentHTML("beforeend",this.getTemplate(this.getStepDatasToRender())),this.afterRender(e)}afterRender(e){this.currentStep=this.options.element.querySelector(this.selector),this.addEvents(),e&&this.renderDatasFromCache&&this.renderDatasFromCache(e)}getStepDatasToRender(){return null}destroy(){this.removeEvents(),this.currentStep.remove()}addEvents(){this.currentStep.addEventListener("click",this.clickOnCurrentStep,!1)}clickOnCurrentStep(e){const t=e.target;"button"===t.nodeName.toLowerCase()&&t.hasAttribute("data-step-previous")?this.clickToPreviousStep(e):"button"===t.nodeName.toLowerCase()&&t.hasAttribute("data-step-next")&&this.clickToNextStep(e)}clickToNextStep(e){e.preventDefault(),(this.stepIsReadyToSubmit||this.optionalStep)&&this.options.element.dispatchEvent(new window.CustomEvent("nextStep"))}clickToPreviousStep(e){e.preventDefault(),this.options.element.dispatchEvent(new window.CustomEvent("previousStep"))}checkIfStepIsReadyToSubmit(){this.stepIsReadyToSubmit=null!==this.getDatasFromStep(),this.updateButtonToValidateStep()}updateButtonToValidateStep(){const e=this.currentStep.querySelector("[data-step-next]");this.stepIsReadyToSubmit||this.optionalStep?e.classList.remove("disabled"):e.classList.add("disabled")}removeEvents(){this.currentStep.removeEventListener("click",this.clickOnCurrentStep)}}}})}));