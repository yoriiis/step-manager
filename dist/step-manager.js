!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.stepManager=e():t.stepManager=e()}(window,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(i,o,function(e){return t[e]}.bind(null,o));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="./src/index.js")}({"./src/cache-manager.js":function(t,e,s){"use strict";s.d(e,"default",(function(){return i}));class i{constructor(t){const e=t||{};this.options=Object.assign({cacheMethod:"sessionStorage",keyBrowserStorage:"stepManager"},e)}getDatasFromCache(t){let e=null;const s=window[this.options.cacheMethod].getItem(this.options.keyBrowserStorage)||null;if(null!==s){const i=JSON.parse(s);e=Array.isArray(t)?this.filterDatas(t,i):i}return e}filterDatas(t,e){let s=null;const i=Object.keys(e).filter(e=>t.includes(e));return i.length&&(s={},i.map(t=>s[t]=e[t])),s}setDatasToCache({route:t,datas:e}){let s=this.getDatasFromCache();s||(s={}),s[t]||(s[t]={}),s[t].datas=e,window[this.options.cacheMethod].setItem(`${this.options.keyBrowserStorage}`,JSON.stringify(s))}removeDatasFromCache(){window[this.options.cacheMethod].removeItem(`${this.options.keyBrowserStorage}`)}}},"./src/index.js":function(t,e,s){"use strict";s.r(e);var i=s("./src/manager.js");s.d(e,"Manager",(function(){return i.default}));var o=s("./src/steps.js");s.d(e,"Steps",(function(){return o.default}))},"./src/manager.js":function(t,e,s){"use strict";s.d(e,"default",(function(){return r}));var i=s("./src/router.js"),o=s("./src/cache-manager.js");
/**
 * @license MIT
 * @name StepManager
 * @version 1.1.0
 * @author: Yoriiis aka Joris DANIEL <joris.daniel@gmail.com>
 * @description: StepManager is a library to create flexible and robust multiple steps navigation with hash, validations, browser storage and hook functions.
 * {@link https://github.com/yoriiis/step-manager}
 * @copyright 2020 Joris DANIEL
 **/
class r{constructor(t){const e=t||{};this.options=Object.assign({element:null,datas:{},steps:[],cacheMethod:"sessionStorage",keyBrowserStorage:"stepManager",onComplete:()=>{}},e),this.isCompleted=!1,this.triggerPreviousStep=this.triggerPreviousStep.bind(this),this.triggerNextStep=this.triggerNextStep.bind(this)}init(){this.addEvents();const t=this.analyzeSteps();this.steps=t.steps,this.CacheManager=new o.default({cacheMethod:this.options.cacheMethod,keyBrowserStorage:this.options.keyBrowserStorage}),this.Router=new i.default({defaultRoute:t.defaultRoute,stepsOrder:t.stepsOrder,steps:this.steps,getDatasFromCache:t=>this.CacheManager.getDatasFromCache(t)}),this.Router.init()}analyzeSteps(){const t={},e=[];let s;return this.options.steps.forEach((i,o)=>{const r=new i,n=r.route;r.requestOptions=()=>this.options,r.requestDatas=(...t)=>this.CacheManager.getDatasFromCache(t),t[n]=r,e.push(n),0===o&&(s=n)}),{steps:t,stepsOrder:e,defaultRoute:s}}addEvents(){this.eventNextStep=new window.Event("nextStep"),this.options.element.addEventListener("nextStep",this.triggerNextStep,!1),this.eventNextStep=new window.Event("previousStep"),this.options.element.addEventListener("previousStep",this.triggerPreviousStep,!1)}triggerNextStep(t){if(!this.isCompleted){const t=this.steps[this.Router.currentRoute].getDatasFromStep();this.CacheManager.setDatasToCache({route:this.Router.currentRoute,datas:t}),this.Router.triggerNext()||this.allStepsComplete()}}triggerPreviousStep(t){this.Router.triggerPrevious()}allStepsComplete(){this.isCompleted=!0,this.options.element.classList.add("loading"),this.Router.destroyStep(this.Router.currentRoute),this.Router.setRoute(""),this.destroy(),this.options.onComplete instanceof Function&&this.options.onComplete(this.CacheManager.getDatasFromCache()),this.CacheManager.removeDatasFromCache()}destroy(){this.options.element.removeEventListener("nextStep",this.triggerNextStep),this.options.element.removeEventListener("previousStep",this.triggerPreviousStep),this.Router.destroy()}}},"./src/router.js":function(t,e,s){"use strict";s.d(e,"default",(function(){return i}));class i{constructor(t){const e=t||{};this.options=Object.assign({defaultRoute:null,stepsOrder:[],steps:{},getDatasFromCache:()=>{}},e),this.reverseNavigation=!1,this.stepCreated=!1,this.applicationReady=!1,this.stepRedirected={},this.hashChanged=this.hashChanged.bind(this)}init(){this.addEvents();const t=this.getRoute();this.currentRoute=""===t?this.options.defaultRoute:t,""===t?this.setRoute(this.currentRoute):this.hashChanged()}addEvents(){window.addEventListener("hashchange",this.hashChanged,!1)}hashChanged(t){const e=this.getRoute(),s=this.checkIfTheStepCanBeDisplay({route:e,event:t});this.currentRoute=e,this.stepCanBeDisplayed(t,s.canBeDisplayed?s.fallbackRoute:null)}stepCanBeDisplayed(t){t&&(this.previousRoute=this.stepRedirected.redirect?this.stepRedirected.previousRoute:this.getPreviousRoute(t),this.previousRoute&&(this.destroyStep(this.previousRoute),this.createStep(this.currentRoute),this.stepCreated=!0)),this.stepCreated||this.createStep(this.currentRoute),this.stepRedirected.redirect&&(this.stepRedirected.redirect=!1)}stepCantBeDisplayed(t,e){this.stepRedirected={redirect:!0,previousRoute:this.getPreviousRoute(t)},this.previousRoute=null,e?this.setRoute(e):this.setRoute(this.options.defaultRoute)}checkIfTheStepCanBeDisplay({route:t,event:e}){if(this.options.steps[t]){return this.options.steps[t].canTheStepBeDisplayed()}{let t=this.options.defaultRoute;const s=this.getPreviousRoute(e);return s&&this.options.steps[s].fallbackRoute&&(t=this.options.steps[s].fallbackRoute),{canBeDisplayed:!1,fallbackRoute:t}}}createStep(t){const e=this.options.getDatasFromCache([t]);e?this.options.steps[t].render(e[t].datas):this.options.steps[t].render(),this.applicationReady||(this.applicationReady=!0)}destroyStep(t){this.options.steps[t].destroy()}triggerNext(){this.reverseNavigation=!1,this.previousRoute=this.currentRoute;const t=this.getNextStepRoute(this.currentRoute);return"end"!==t&&(this.setRoute(t),!0)}triggerPrevious(){this.reverseNavigation=!0,this.previousRoute=this.currentRoute;const t=this.getPreviousStepRoute(this.previousRoute);this.setRoute(t)}getPreviousRoute(t){return t&&t.oldURL?t.oldURL.split("#")[1]:null}getPreviousStepRoute(t){const e=parseInt(this.getIndexFromRoute(t)),s=this.options.steps[this.options.stepsOrder[e-1]];return s?s.route:this.options.defaultRoute}getNextStepRoute(t){const e=parseInt(this.getIndexFromRoute(t)),s=this.options.steps[this.options.stepsOrder[e+1]];return s?s.route:"end"}getIndexFromRoute(t){return this.options.stepsOrder.findIndex(e=>e===t)}getRoute(){return window.location.hash.substr(1)}setRoute(t){window.location.hash=t}destroy(){window.removeEventListener("hashchange",this.hashChanged)}}},"./src/steps.js":function(t,e,s){"use strict";function i(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}s.d(e,"default",(function(){return o}));class o{constructor(){i(this,"fallbackRoute",null),i(this,"optionalStep",!1),this.clickOnCurrentStep=this.clickOnCurrentStep.bind(this)}render(t){this.options=this.requestOptions(),this.options.element.insertAdjacentHTML("beforeend",this.getTemplate()),this.afterRender(t)}afterRender(t){this.currentStep=this.options.element.querySelector(this.selector),this.addEvents(),t&&this.renderDatasFromCache&&this.renderDatasFromCache(t)}destroy(){this.removeEvents(),this.currentStep.remove()}addEvents(){this.currentStep.addEventListener("click",this.clickOnCurrentStep,!1)}clickOnCurrentStep(t){const e=t.target;"button"===e.nodeName.toLowerCase()&&e.hasAttribute("data-step-previous")?this.clickToPreviousStep(t):"button"===e.nodeName.toLowerCase()&&e.hasAttribute("data-step-next")&&this.clickToNextStep(t)}clickToNextStep(t){t.preventDefault(),(this.stepIsReadyToSubmit||this.optionalStep)&&this.options.element.dispatchEvent(new window.CustomEvent("nextStep"))}clickToPreviousStep(t){t.preventDefault(),this.options.element.dispatchEvent(new window.CustomEvent("previousStep"))}checkIfStepIsReadyToSubmit(){this.stepIsReadyToSubmit=null!==this.getDatasFromStep(),this.updateButtonToValidateStep()}updateButtonToValidateStep(){const t=this.currentStep.querySelector("[data-step-next]");this.stepIsReadyToSubmit||this.optionalStep?t.classList.remove("disabled"):t.classList.add("disabled")}removeEvents(){this.currentStep.removeEventListener("click",this.clickOnCurrentStep)}}}})}));